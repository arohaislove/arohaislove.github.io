<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Perspective Engine - Aroha's Projects</title>

    <!-- Privacy-friendly analytics by Plausible -->
    <script async src="https://plausible.io/js/pa-YDHVJtiLBBWA8IRTBSaq6.js"></script>
    <script>
      window.plausible=window.plausible||function(){(plausible.q=plausible.q||[]).push(arguments)},plausible.init=plausible.init||function(i){plausible.o=i||{}};
      plausible.init()
    </script>
    <script src="/shared/analytics.js"></script>

    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
                'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',
                sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* NOW Dot Pulse Animation */
        @keyframes pulse-now {
            0%, 100% {
                transform: scale(1);
                opacity: 1;
            }
            50% {
                transform: scale(1.1);
                opacity: 0.9;
            }
        }

        .pulse-now {
            animation: pulse-now 2s ease-in-out infinite;
        }

        /* Death Sequence Animations */
        @keyframes die {
            to {
                background-color: rgb(75 85 99 / 0.6);
                box-shadow: none;
            }
        }

        @keyframes final-pulse {
            0%, 100% {
                transform: scale(1.5);
                opacity: 1;
            }
            50% {
                transform: scale(1.8);
                opacity: 0.7;
            }
        }

        /* Buddhism - Dissolve and Flow */
        @keyframes buddhist-dissolve {
            0% {
                opacity: 1;
                transform: translateY(0) scale(1) rotate(0deg);
                filter: brightness(1) hue-rotate(0deg);
                box-shadow: 0 0 15px rgba(59, 130, 246, 0.6);
            }
            33% {
                opacity: 0.4;
                transform: translateY(15px) scale(0.6) rotate(120deg);
                filter: brightness(1.5) hue-rotate(60deg);
                box-shadow: 0 0 25px rgba(147, 197, 253, 0.8);
            }
            66% {
                opacity: 0.2;
                transform: translateY(5px) scale(0.3) rotate(240deg);
                filter: brightness(2) hue-rotate(120deg);
                box-shadow: 0 0 35px rgba(191, 219, 254, 1);
            }
            100% {
                opacity: 1;
                transform: translateY(0) scale(1) rotate(360deg);
                filter: brightness(1) hue-rotate(360deg);
                box-shadow: 0 0 15px rgba(59, 130, 246, 0.6);
            }
        }

        @keyframes nirvana-merge {
            0% {
                opacity: 1;
                transform: scale(1);
                filter: blur(0px) brightness(1);
                box-shadow: 0 0 10px rgba(59, 130, 246, 0.5);
            }
            50% {
                opacity: 0.7;
                transform: scale(2.5);
                filter: blur(8px) brightness(2);
                box-shadow: 0 0 40px rgba(147, 197, 253, 1), 0 0 80px rgba(191, 219, 254, 0.8);
            }
            to {
                opacity: 0;
                transform: scale(4);
                filter: blur(20px) brightness(3);
                box-shadow: 0 0 60px rgba(191, 219, 254, 1), 0 0 120px rgba(224, 242, 254, 0.9);
            }
        }

        /* Christianity - Heaven */
        @keyframes rise-to-heaven {
            0% {
                transform: translateY(0) scale(1);
                background: linear-gradient(135deg, #fbbf24, #f59e0b);
                box-shadow: 0 0 10px rgba(251, 191, 36, 0.4);
                filter: brightness(1);
            }
            50% {
                transform: translateY(-150px) scale(1.3);
                background: linear-gradient(135deg, #fef3c7, #fde68a);
                box-shadow: 0 0 40px rgba(251, 191, 36, 1), 0 0 80px rgba(254, 243, 199, 0.8);
                filter: brightness(2);
            }
            to {
                transform: translateY(-300px) scale(1.5);
                background: radial-gradient(circle, #ffffff, #fef3c7);
                box-shadow: 0 0 60px rgba(255, 255, 255, 1), 0 0 120px rgba(251, 191, 36, 0.9), 0 0 180px rgba(254, 243, 199, 0.6);
                filter: brightness(3);
            }
        }

        /* Christianity - Purgatory */
        @keyframes purgatory-purify {
            0%, 100% {
                background-color: rgb(75 85 99 / 0.6);
                filter: brightness(1);
                box-shadow: 0 0 5px rgba(75, 85, 99, 0.3);
            }
            25% {
                background: linear-gradient(135deg, #9ca3af, #d1d5db);
                filter: brightness(1.5);
                box-shadow: 0 0 20px rgba(209, 213, 219, 0.7);
            }
            50% {
                background: linear-gradient(135deg, #ffffff, #f3f4f6);
                filter: brightness(2.5);
                box-shadow: 0 0 40px rgba(255, 255, 255, 1);
            }
            75% {
                background: linear-gradient(135deg, #d1d5db, #9ca3af);
                filter: brightness(1.5);
                box-shadow: 0 0 20px rgba(209, 213, 219, 0.7);
            }
        }

        /* Christianity - Hell */
        @keyframes descend-to-hell {
            0% {
                transform: translateY(0) scale(1) rotate(0deg);
                background: linear-gradient(135deg, #7f1d1d, #991b1b);
                box-shadow: 0 0 10px rgba(127, 29, 29, 0.5);
                filter: brightness(1);
            }
            50% {
                transform: translateY(150px) scale(0.8) rotate(180deg);
                background: linear-gradient(135deg, #991b1b, #7f1d1d);
                box-shadow: 0 0 30px rgba(220, 38, 38, 0.9), 0 0 60px rgba(185, 28, 28, 0.7);
                filter: brightness(1.5);
            }
            to {
                transform: translateY(300px) scale(0.6) rotate(360deg);
                background: radial-gradient(circle, #450a0a, #7f1d1d);
                box-shadow: 0 0 50px rgba(220, 38, 38, 1), 0 0 100px rgba(127, 29, 29, 0.8);
                filter: brightness(0.8) contrast(1.5);
            }
        }

        /* Islam - Jannah */
        @keyframes barzakh-pause {
            0%, 50% {
                opacity: 0.5;
                filter: blur(3px);
                box-shadow: 0 0 10px rgba(75, 85, 99, 0.4);
            }
            100% {
                opacity: 1;
                filter: blur(0px);
                box-shadow: 0 0 20px rgba(16, 185, 129, 0.6);
            }
        }

        @keyframes rise-to-jannah {
            0% {
                transform: translateY(0) scale(1);
                background: linear-gradient(135deg, #10b981, #059669);
                box-shadow: 0 0 10px rgba(16, 185, 129, 0.5);
                filter: brightness(1);
            }
            50% {
                transform: translateY(-125px) scale(1.2);
                background: linear-gradient(135deg, #34d399, #10b981, #fbbf24);
                box-shadow: 0 0 40px rgba(16, 185, 129, 1), 0 0 80px rgba(251, 191, 36, 0.8);
                filter: brightness(2);
            }
            to {
                transform: translateY(-250px) scale(1.4);
                background: radial-gradient(circle, #d1fae5, #34d399, #fde68a);
                box-shadow: 0 0 60px rgba(52, 211, 153, 1), 0 0 120px rgba(251, 191, 36, 0.9), 0 0 180px rgba(209, 250, 229, 0.7);
                filter: brightness(2.5);
            }
        }

        /* Islam - Jahannam */
        @keyframes descend-to-jahannam {
            0% {
                transform: translateY(0) scale(1) rotate(0deg);
                background: linear-gradient(135deg, #991b1b, #7f1d1d);
                box-shadow: 0 0 10px rgba(153, 27, 27, 0.5);
                filter: brightness(1);
            }
            50% {
                transform: translateY(150px) scale(0.7) rotate(180deg);
                background: linear-gradient(135deg, #dc2626, #991b1b);
                box-shadow: 0 0 35px rgba(220, 38, 38, 1), 0 0 70px rgba(153, 27, 27, 0.8);
                filter: brightness(1.5) saturate(1.5);
            }
            to {
                transform: translateY(300px) scale(0.5) rotate(360deg);
                background: radial-gradient(circle, #450a0a, #991b1b);
                box-shadow: 0 0 50px rgba(220, 38, 38, 1), 0 0 100px rgba(153, 27, 27, 0.9);
                filter: brightness(0.7) saturate(2) contrast(1.5);
            }
        }

        /* Hinduism - Reincarnation */
        @keyframes reincarnate-scatter {
            0% {
                transform: translate(0, 0) scale(1) rotate(0deg);
                opacity: 1;
                filter: brightness(1) saturate(1);
                box-shadow: 0 0 10px rgba(251, 146, 60, 0.5);
            }
            25% {
                transform: translate(calc(var(--scatter-x) * 0.5), calc(var(--scatter-y) * 0.5)) scale(1.2) rotate(90deg);
                opacity: 0.7;
                filter: brightness(2) saturate(1.5);
                box-shadow: 0 0 30px rgba(251, 146, 60, 1);
            }
            50% {
                transform: translate(var(--scatter-x), var(--scatter-y)) scale(0.3) rotate(180deg);
                opacity: 0;
                filter: brightness(3) saturate(2) hue-rotate(90deg);
                box-shadow: 0 0 50px rgba(251, 146, 60, 1), 0 0 100px rgba(251, 191, 36, 0.8);
            }
            75% {
                transform: translate(calc(var(--reborn-x) * 0.5), calc(var(--reborn-y) * 0.5)) scale(0.5) rotate(270deg);
                opacity: 0.5;
                filter: brightness(2) saturate(1.5) hue-rotate(180deg);
                box-shadow: 0 0 30px rgba(251, 146, 60, 0.8);
            }
            100% {
                transform: translate(var(--reborn-x), var(--reborn-y)) scale(1) rotate(360deg);
                opacity: 1;
                filter: brightness(1) saturate(1) hue-rotate(0deg);
                box-shadow: 0 0 10px rgba(251, 146, 60, 0.5);
            }
        }

        /* Hinduism - Moksha */
        @keyframes moksha-expand {
            0% {
                transform: scale(1);
                opacity: 1;
                filter: blur(0px) brightness(1);
                box-shadow: 0 0 10px rgba(251, 146, 60, 0.5);
            }
            33% {
                transform: scale(2);
                opacity: 0.8;
                filter: blur(5px) brightness(2);
                box-shadow: 0 0 40px rgba(251, 146, 60, 1), 0 0 80px rgba(254, 215, 170, 0.8);
            }
            66% {
                transform: scale(4);
                opacity: 0.4;
                filter: blur(15px) brightness(3);
                box-shadow: 0 0 80px rgba(254, 215, 170, 1), 0 0 160px rgba(255, 237, 213, 0.9);
            }
            to {
                transform: scale(6);
                opacity: 0;
                filter: blur(30px) brightness(4);
                box-shadow: 0 0 120px rgba(255, 237, 213, 1), 0 0 240px rgba(255, 251, 235, 0.8);
            }
        }

        /* Judaism - Rest */
        @keyframes judaic-rest {
            to {
                box-shadow: 0 0 8px rgba(251, 191, 36, 0.4);
                filter: brightness(1.2);
            }
        }

        /* Ancestor Traditions */
        @keyframes move-to-past {
            to {
                transform: translateZ(-100px) translateY(-20px);
                opacity: 0.4;
                filter: blur(2px);
            }
        }

        /* Analytic Idealism */
        @keyframes dissolve-boundaries {
            0% {
                border-radius: 20%;
                opacity: 1;
                filter: blur(0px) brightness(1);
                box-shadow: 0 0 10px rgba(168, 85, 247, 0.5);
            }
            33% {
                border-radius: 40%;
                opacity: 0.7;
                filter: blur(4px) brightness(1.5);
                box-shadow: 0 0 30px rgba(168, 85, 247, 0.8), 0 0 60px rgba(192, 132, 252, 0.6);
            }
            66% {
                border-radius: 50%;
                opacity: 0.4;
                filter: blur(12px) brightness(2);
                box-shadow: 0 0 50px rgba(192, 132, 252, 1), 0 0 100px rgba(216, 180, 254, 0.8);
            }
            to {
                border-radius: 50%;
                opacity: 0.1;
                filter: blur(20px) brightness(3);
                box-shadow: 0 0 80px rgba(216, 180, 254, 1), 0 0 160px rgba(233, 213, 255, 0.9);
            }
        }

        /* Panpsychism */
        @keyframes fragment-consciousness {
            0% {
                transform: translate(0, 0) scale(1);
                opacity: 1;
                filter: brightness(1);
                box-shadow: 0 0 10px rgba(96, 165, 250, 0.5);
            }
            25% {
                transform: translate(calc(var(--fragment-x) * 0.3), calc(var(--fragment-y) * 0.3)) scale(0.8);
                opacity: 0.9;
                filter: brightness(1.5);
                box-shadow: 0 0 20px rgba(96, 165, 250, 0.8);
            }
            50% {
                transform: translate(calc(var(--fragment-x) * 0.6), calc(var(--fragment-y) * 0.6)) scale(0.5);
                opacity: 0.8;
                filter: brightness(2);
                box-shadow: 0 0 30px rgba(147, 197, 253, 1), 0 0 60px rgba(191, 219, 254, 0.7);
            }
            to {
                transform: translate(var(--fragment-x), var(--fragment-y)) scale(0.2);
                opacity: 0.6;
                filter: brightness(2.5);
                box-shadow: 0 0 40px rgba(191, 219, 254, 1), 0 0 80px rgba(224, 242, 254, 0.8);
            }
        }

        /* Illusionism */
        @keyframes switch-off {
            0% {
                opacity: 1;
                filter: blur(0px) brightness(1);
                box-shadow: 0 0 5px rgba(75, 85, 99, 0.3);
            }
            30% {
                opacity: 0.7;
                filter: blur(1px) brightness(0.8);
                box-shadow: 0 0 10px rgba(75, 85, 99, 0.4);
            }
            50% {
                opacity: 0.4;
                filter: blur(3px) brightness(0.5);
                box-shadow: 0 0 15px rgba(75, 85, 99, 0.5);
            }
            70% {
                opacity: 0.2;
                filter: blur(5px) brightness(0.3);
                box-shadow: 0 0 10px rgba(75, 85, 99, 0.3);
            }
            100% {
                opacity: 0;
                filter: blur(8px) brightness(0);
                box-shadow: none;
            }
        }

        /* Simulation Theory */
        @keyframes glitch {
            0%, 100% {
                transform: translate(0, 0) scale(1);
                opacity: 1;
                filter: hue-rotate(0deg) saturate(1);
                box-shadow: 0 0 5px rgba(34, 211, 238, 0.5);
            }
            10% {
                transform: translate(-3px, 2px) scale(1.05);
                opacity: 0.9;
                filter: hue-rotate(30deg) saturate(1.5);
                box-shadow: 0 0 15px rgba(34, 211, 238, 0.8), -3px 0 5px rgba(239, 68, 68, 0.5);
            }
            20% {
                transform: translate(3px, -2px) scale(0.95);
                opacity: 0.8;
                filter: hue-rotate(60deg) saturate(2);
                box-shadow: 0 0 20px rgba(34, 211, 238, 1), 3px 0 5px rgba(34, 197, 94, 0.5);
            }
            30% {
                transform: translate(-2px, -3px) scale(1.02);
                opacity: 0.7;
                filter: hue-rotate(90deg) saturate(1.8);
                box-shadow: 0 0 25px rgba(147, 197, 253, 1);
            }
            40% {
                transform: translate(2px, 3px) scale(0.98);
                opacity: 0.6;
                filter: hue-rotate(120deg) saturate(1.5);
                box-shadow: 0 0 20px rgba(34, 211, 238, 0.8);
            }
            50% {
                transform: translate(-4px, 1px) scale(1.08);
                opacity: 0.5;
                filter: hue-rotate(150deg) saturate(2.5);
                box-shadow: 0 0 30px rgba(34, 211, 238, 1), 0 0 60px rgba(56, 189, 248, 0.7);
            }
            60% {
                transform: translate(1px, -4px) scale(0.92);
                opacity: 0.4;
                filter: hue-rotate(180deg) saturate(2);
                box-shadow: 0 0 20px rgba(34, 211, 238, 0.8);
            }
            70% {
                transform: translate(-1px, 2px) scale(1.03);
                opacity: 0.3;
                filter: hue-rotate(210deg) saturate(1.5);
                box-shadow: 0 0 15px rgba(34, 211, 238, 0.6);
            }
            80% {
                transform: translate(2px, -1px) scale(0.97);
                opacity: 0.2;
                filter: hue-rotate(240deg) saturate(1.2);
                box-shadow: 0 0 10px rgba(34, 211, 238, 0.4);
            }
            90% {
                transform: translate(-2px, -2px) scale(1.01);
                opacity: 0.1;
                filter: hue-rotate(270deg) saturate(1);
                box-shadow: 0 0 5px rgba(34, 211, 238, 0.2);
            }
        }

        /* Atomic Dispersal */
        @keyframes atomic-drift {
            0% {
                transform: translate(0, 0) scale(1) rotate(0deg);
                opacity: 1;
                filter: brightness(1) saturate(1);
                box-shadow: 0 0 10px currentColor;
            }
            25% {
                transform: translate(calc(var(--drift-x) * 0.3), calc(var(--drift-y) * 0.3)) scale(0.9) rotate(90deg);
                opacity: 0.95;
                filter: brightness(1.2) saturate(1.3) hue-rotate(30deg);
                box-shadow: 0 0 15px currentColor, 0 0 30px rgba(34, 197, 94, 0.5);
            }
            50% {
                transform: translate(calc(var(--drift-x) * 0.6), calc(var(--drift-y) * 0.6)) scale(0.7) rotate(180deg);
                opacity: 0.9;
                filter: brightness(1.4) saturate(1.5) hue-rotate(60deg);
                box-shadow: 0 0 20px currentColor, 0 0 40px rgba(34, 197, 94, 0.7);
            }
            75% {
                transform: translate(calc(var(--drift-x) * 0.85), calc(var(--drift-y) * 0.85)) scale(0.5) rotate(270deg);
                opacity: 0.85;
                filter: brightness(1.6) saturate(1.7) hue-rotate(90deg);
                box-shadow: 0 0 25px currentColor, 0 0 50px rgba(34, 197, 94, 0.8);
            }
            to {
                transform: translate(var(--drift-x), var(--drift-y)) scale(0.3) rotate(360deg);
                opacity: 0.75;
                filter: brightness(1.8) saturate(2) hue-rotate(120deg);
                box-shadow: 0 0 30px currentColor, 0 0 60px rgba(34, 197, 94, 1);
            }
        }

        /* Heat Death */
        @keyframes heat-death {
            0% {
                background-color: currentColor;
                opacity: 1;
                filter: blur(0px) brightness(1) saturate(1);
                box-shadow: 0 0 5px rgba(107, 114, 128, 0.3);
            }
            20% {
                background-color: rgb(107 114 128 / 0.9);
                opacity: 0.9;
                filter: blur(1px) brightness(0.95) saturate(0.9);
                box-shadow: 0 0 10px rgba(107, 114, 128, 0.3);
            }
            40% {
                background-color: rgb(75 85 99 / 0.8);
                opacity: 0.75;
                filter: blur(2px) brightness(0.85) saturate(0.7);
                box-shadow: 0 0 8px rgba(107, 114, 128, 0.25);
            }
            60% {
                background-color: rgb(55 65 81 / 0.6);
                opacity: 0.6;
                filter: blur(3px) brightness(0.7) saturate(0.5);
                box-shadow: 0 0 6px rgba(107, 114, 128, 0.2);
            }
            80% {
                background-color: rgb(55 65 81 / 0.4);
                opacity: 0.45;
                filter: blur(4px) brightness(0.5) saturate(0.3);
                box-shadow: 0 0 4px rgba(107, 114, 128, 0.15);
            }
            to {
                background-color: rgb(55 65 81 / 0.2);
                opacity: 0.2;
                filter: blur(6px) brightness(0.3) saturate(0.1);
                box-shadow: 0 0 2px rgba(107, 114, 128, 0.1);
            }
        }

        /* Page Atmosphere Transitions */
        .atmosphere-buddhism {
            background: linear-gradient(to br, rgb(17, 24, 39), rgb(30, 58, 138), rgb(17, 24, 39)) !important;
            transition: background 2s ease-in-out;
        }

        .atmosphere-heaven {
            background: linear-gradient(to br, rgb(120, 53, 15), rgb(251, 191, 36), rgb(17, 24, 39)) !important;
            transition: background 2s ease-in-out;
        }

        .atmosphere-hell {
            background: linear-gradient(to br, rgb(0, 0, 0), rgb(127, 29, 29), rgb(0, 0, 0)) !important;
            transition: background 2s ease-in-out;
        }

        .atmosphere-jannah {
            background: linear-gradient(to br, rgb(6, 78, 59), rgb(16, 185, 129), rgb(17, 24, 39)) !important;
            transition: background 2s ease-in-out;
        }

        .atmosphere-jahannam {
            background: linear-gradient(to br, rgb(0, 0, 0), rgb(153, 27, 27), rgb(0, 0, 0)) !important;
            transition: background 2s ease-in-out;
        }

        .atmosphere-hinduism {
            background: linear-gradient(to br, rgb(124, 45, 18), rgb(251, 146, 60), rgb(17, 24, 39)) !important;
            transition: background 2s ease-in-out;
        }

        .atmosphere-judaism {
            background: linear-gradient(to br, rgb(17, 24, 39), rgb(55, 48, 41), rgb(17, 24, 39)) !important;
            transition: background 2s ease-in-out;
        }

        .atmosphere-ancestor {
            background: linear-gradient(to br, rgb(28, 25, 23), rgb(68, 64, 60), rgb(17, 24, 39)) !important;
            transition: background 2s ease-in-out;
        }

        .atmosphere-idealism {
            background: linear-gradient(to br, rgb(17, 24, 39), rgb(88, 28, 135), rgb(17, 24, 39)) !important;
            filter: blur(0.5px);
            transition: background 2s ease-in-out;
        }

        .atmosphere-panpsychism {
            background: linear-gradient(to br, rgb(17, 24, 39), rgb(30, 58, 138), rgb(17, 24, 39)) !important;
            transition: background 2s ease-in-out;
        }

        .atmosphere-illusionism {
            background: linear-gradient(to br, rgb(17, 24, 39), rgb(31, 41, 55), rgb(17, 24, 39)) !important;
            transition: background 2s ease-in-out;
        }

        .atmosphere-simulation {
            background: linear-gradient(to br, rgb(17, 24, 39), rgb(30, 41, 59), rgb(17, 24, 39)) !important;
            transition: background 2s ease-in-out;
        }

        .atmosphere-atomic {
            background: linear-gradient(to br, rgb(20, 33, 23), rgb(34, 51, 32), rgb(17, 24, 39)) !important;
            transition: background 2s ease-in-out;
        }

        .atmosphere-heatdeath {
            background: linear-gradient(to br, rgb(17, 24, 39), rgb(31, 41, 55), rgb(17, 24, 39)) !important;
            filter: brightness(0.7);
            transition: background 2s ease-in-out, filter 2s ease-in-out;
        }

        /* Worldview-specific border effects */
        .border-buddhism {
            border: 1px solid rgba(59, 130, 246, 0.5);
            box-shadow: 0 0 10px rgba(59, 130, 246, 0.3);
        }

        .border-heaven {
            border: 1px solid rgba(251, 191, 36, 0.6);
            box-shadow: 0 0 15px rgba(251, 191, 36, 0.5);
        }

        .border-hell {
            border: 1px solid rgba(127, 29, 29, 0.8);
            box-shadow: 0 0 12px rgba(220, 38, 38, 0.4);
        }

        .border-jannah {
            border: 1px solid rgba(16, 185, 129, 0.6);
            box-shadow: 0 0 12px rgba(16, 185, 129, 0.4);
        }

        .border-jahannam {
            border: 1px solid rgba(153, 27, 27, 0.7);
            box-shadow: 0 0 10px rgba(153, 27, 27, 0.5);
        }

        .border-hinduism {
            border: 1px solid rgba(251, 146, 60, 0.6);
            box-shadow: 0 0 12px rgba(251, 146, 60, 0.4);
        }

        .border-judaism {
            border: 1px solid rgba(251, 191, 36, 0.4);
            box-shadow: 0 0 8px rgba(251, 191, 36, 0.3);
        }

        .border-ancestor {
            border: 1px solid rgba(120, 113, 108, 0.5);
            box-shadow: 0 0 8px rgba(120, 113, 108, 0.3);
        }

        .border-idealism {
            border: 1px solid rgba(168, 85, 247, 0.5);
            box-shadow: 0 0 15px rgba(168, 85, 247, 0.4);
        }

        .border-panpsychism {
            border: 1px solid rgba(96, 165, 250, 0.5);
            box-shadow: 0 0 10px rgba(96, 165, 250, 0.4);
        }

        .border-illusionism {
            border: 1px solid rgba(75, 85, 99, 0.3);
            box-shadow: none;
        }

        .border-simulation {
            border: 1px solid rgba(34, 211, 238, 0.5);
            box-shadow: 0 0 8px rgba(34, 211, 238, 0.3), inset 0 0 4px rgba(34, 211, 238, 0.2);
        }

        .border-atomic {
            border: 1px solid rgba(34, 197, 94, 0.5);
            box-shadow: 0 0 10px rgba(34, 197, 94, 0.3);
        }

        .border-heatdeath {
            border: 1px solid rgba(107, 114, 128, 0.3);
            box-shadow: 0 0 5px rgba(107, 114, 128, 0.2);
        }

        /* Modal Styles */
        .modal-backdrop {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            backdrop-filter: blur(4px);
        }

        .modal-content {
            max-height: 90vh;
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: rgba(156, 163, 175, 0.3) transparent;
        }

        .modal-content::-webkit-scrollbar {
            width: 8px;
        }

        .modal-content::-webkit-scrollbar-track {
            background: transparent;
        }

        .modal-content::-webkit-scrollbar-thumb {
            background-color: rgba(156, 163, 175, 0.3);
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <!-- Module Loader: Dynamically loads all afterlife perspective modules -->
    <script type="module">
        /**
         * Afterlife Module Loader
         *
         * This script dynamically loads all afterlife perspective modules from the
         * /afterlives/ directory and makes them available to the React app.
         *
         * Architecture:
         * 1. Load all modules from the registry (afterlives/index.js)
         * 2. Flatten multi-variant modules (e.g., Buddhism has rebirth + nirvana)
         * 3. Build worldviews object from module metadata
         * 4. Inject CSS from modules into the page
         * 5. Store in global window object for React app to use
         */

        console.log('[Module Loader] ========== MODULE SCRIPT STARTED ==========');
        console.log('[Module Loader] Script type=module is executing');
        console.log('[Module Loader] Timestamp:', new Date().toISOString());

        // Global storage for loaded modules
        window.AfterlifeModules = {};
        window.AfterlifeWorldviews = {};

        /**
         * Load and register all afterlife modules
         */
        async function loadAfterlifeModules() {
            try {
                console.log('[Afterlife Engine] ========== MODULE LOADING START ==========');

                // Use dynamic import for better error handling
                console.log('[Afterlife Engine] Dynamically importing ./afterlives/index.js...');
                const afterlifeModules = await import('./afterlives/index.js');
                console.log('[Afterlife Engine] Import completed successfully');
                console.log('[Afterlife Engine] afterlifeModules object:', afterlifeModules);
                console.log('[Afterlife Engine] afterlifeModules keys:', Object.keys(afterlifeModules));

                // Process each module from the registry
                const entries = Object.entries(afterlifeModules);
                console.log('[Afterlife Engine] Number of module entries:', entries.length);

                if (entries.length === 0) {
                    console.error('[Afterlife Engine] ERROR: No modules found in afterlifeModules!');
                    console.error('[Afterlife Engine] This means the import from ./afterlives/index.js failed or returned nothing');
                    throw new Error('No afterlife modules found');
                }

                entries.forEach(([key, module]) => {
                    console.log(`[Afterlife Engine] Processing module entry: ${key}`, module);
                    const moduleDefault = module.default || module;

                    // Check if this module has multiple variants (e.g., Christianity: heaven, purgatory, hell)
                    if (moduleDefault.metadata && moduleDefault.metadata.variants) {
                        console.log(`[Afterlife Engine] Loading multi-variant module: ${moduleDefault.metadata.name}`);

                        // Register each variant as a separate perspective
                        moduleDefault.metadata.variants.forEach(variant => {
                            const variantModule = moduleDefault[variant];
                            if (variantModule && variantModule.metadata) {
                                window.AfterlifeModules[variantModule.metadata.id] = variantModule;
                                console.log(`  ✓ Registered: ${variantModule.metadata.id}`);
                            } else {
                                console.warn(`  ⚠ Variant ${variant} not found or invalid`);
                            }
                        });
                    } else if (moduleDefault.metadata) {
                        // Single perspective module
                        window.AfterlifeModules[moduleDefault.metadata.id] = moduleDefault;
                        console.log(`[Afterlife Engine] ✓ Registered: ${moduleDefault.metadata.id}`);
                    } else {
                        console.warn(`[Afterlife Engine] ⚠ Module ${key} has no metadata, skipping`);
                    }
                });

                console.log('[Afterlife Engine] Building worldviews...');
                // Build worldviews object from module metadata
                buildWorldviews();

                console.log('[Afterlife Engine] Injecting module styles...');
                // Inject CSS from all modules
                injectModuleStyles();

                console.log(`[Afterlife Engine] ✓ Loaded ${Object.keys(window.AfterlifeModules).length} perspectives`);

                // Signal that modules are ready
                window.afterlifeModulesReady = true;
                console.log('[Afterlife Engine] Dispatching afterlifeModulesLoaded event...');
                window.dispatchEvent(new Event('afterlifeModulesLoaded'));
                console.log('[Afterlife Engine] ========== MODULE LOADING COMPLETE ==========');
            } catch (error) {
                console.error('[Afterlife Engine] ========== MODULE LOADING FAILED ==========');
                console.error('[Afterlife Engine] Error:', error);
                console.error('[Afterlife Engine] Stack:', error.stack);
                throw error; // Re-throw so the .catch() handler gets it
            }
        }

        /**
         * Build the worldviews object from module metadata
         * This replaces the hardcoded worldviews object
         */
        function buildWorldviews() {
            Object.entries(window.AfterlifeModules).forEach(([id, module]) => {
                const meta = module.metadata;
                window.AfterlifeWorldviews[id] = {
                    name: meta.name,
                    description: meta.description,
                    source: meta.source,
                    atmosphere: module.getAtmosphereClass ? module.getAtmosphereClass() : '',
                    borderClass: module.getBorderClass ? module.getBorderClass() : '',
                    category: meta.category || 'philosophical',
                    tradition: meta.tradition || null
                };
            });
        }

        /**
         * Inject CSS styles from all modules into the page
         * This allows each module to define its own animations
         */
        function injectModuleStyles() {
            const styleElement = document.createElement('style');
            styleElement.id = 'afterlife-module-styles';
            let allStyles = '/* Dynamically injected module styles */\n\n';

            Object.entries(window.AfterlifeModules).forEach(([id, module]) => {
                if (module.getStyles) {
                    allStyles += `/* ${module.metadata.name} */\n`;
                    allStyles += module.getStyles();
                    allStyles += '\n\n';
                }
            });

            styleElement.textContent = allStyles;
            document.head.appendChild(styleElement);
            console.log('[Afterlife Engine] ✓ Injected module styles');
        }

        /**
         * Helper function to get animation for a specific dot
         * This replaces the massive switch statements
         */
        window.getAnimationForDot = function(dot, userData, worldviewKey, isDeathSequence) {
            if (!worldviewKey || isDeathSequence) {
                return { class: '', style: {} };
            }

            const module = window.AfterlifeModules[worldviewKey];
            if (!module) {
                console.warn(`[Afterlife Engine] Module not found: ${worldviewKey}`);
                return { class: '', style: {} };
            }

            try {
                return {
                    class: module.getAnimationClass(dot, userData, isDeathSequence),
                    style: module.getAnimationStyle ? module.getAnimationStyle(dot, userData) : {}
                };
            } catch (error) {
                console.error(`[Afterlife Engine] Error getting animation for ${worldviewKey}:`, error);
                return { class: '', style: {} };
            }
        };

        // Load modules immediately
        console.log('[Afterlife Engine] *** About to call loadAfterlifeModules() ***');
        console.log('[Afterlife Engine] Current timestamp:', Date.now());
        loadAfterlifeModules()
            .then(() => {
                console.log('[Afterlife Engine] *** loadAfterlifeModules() completed successfully ***');
            })
            .catch(error => {
                console.error('[Afterlife Engine] *** loadAfterlifeModules() FAILED ***');
                console.error('[Afterlife Engine] Error:', error);
                console.error('[Afterlife Engine] Stack:', error.stack);
            });
    </script>

    <!-- Haptic Feedback Utility -->
    <script>
        /**
         * Haptic Feedback Manager
         * Provides subtle vibration feedback for Christian Heaven afterlife transitions
         * with rate limiting to prevent overwhelming vibrations
         */
        window.HapticFeedback = {
            // Settings
            enabled: false,
            lastVibrationTime: 0,
            minTimeBetweenVibrations: 500, // ms - prevents vibration stacking

            // Vibration patterns
            patterns: {
                // Gentle double-pulse pattern suggesting a heartbeat fading
                death: [30, 50, 30],
                // Single gentle pulse for ascension
                ascent: [50]
            },

            /**
             * Check if Vibration API is supported
             */
            isSupported() {
                return 'vibrate' in navigator;
            },

            /**
             * Enable haptic feedback
             */
            enable() {
                this.enabled = true;
                if (typeof localStorage !== 'undefined') {
                    localStorage.setItem('hapticFeedbackEnabled', 'true');
                }
                console.log('[Haptic Feedback] Enabled');
            },

            /**
             * Disable haptic feedback
             */
            disable() {
                this.enabled = false;
                if (typeof localStorage !== 'undefined') {
                    localStorage.setItem('hapticFeedbackEnabled', 'false');
                }
                console.log('[Haptic Feedback] Disabled');
            },

            /**
             * Load setting from localStorage
             */
            loadSetting() {
                if (typeof localStorage !== 'undefined') {
                    const saved = localStorage.getItem('hapticFeedbackEnabled');
                    this.enabled = saved === 'true';
                }
            },

            /**
             * Check if enough time has passed since last vibration
             */
            canVibrate() {
                const now = Date.now();
                return now - this.lastVibrationTime >= this.minTimeBetweenVibrations;
            },

            /**
             * Trigger haptic feedback with rate limiting
             * @param {string} pattern - Pattern name ('death' or 'ascent')
             */
            vibrate(pattern = 'death') {
                // Check all conditions
                if (!this.enabled) return;
                if (!this.isSupported()) return;
                if (!this.canVibrate()) return;

                const vibrationPattern = this.patterns[pattern] || this.patterns.death;

                try {
                    navigator.vibrate(vibrationPattern);
                    this.lastVibrationTime = Date.now();
                    console.log(`[Haptic Feedback] Vibrated with pattern: ${pattern}`);
                } catch (error) {
                    console.warn('[Haptic Feedback] Failed to vibrate:', error);
                }
            },

            /**
             * Trigger vibration on death sequence start
             */
            onDeathSequence() {
                this.vibrate('death');
            },

            /**
             * Trigger vibration on ascent to heaven
             * (Currently not used, but available for future enhancement)
             */
            onAscent() {
                this.vibrate('ascent');
            }
        };

        // Load saved setting on page load
        window.HapticFeedback.loadSetting();
    </script>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Simple SVG icons as React components
        const ClockIcon = () => (
            <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <circle cx="12" cy="12" r="10" strokeWidth="2"/>
                <path d="M12 6v6l4 2" strokeWidth="2" strokeLinecap="round"/>
            </svg>
        );

        const CalendarIcon = () => (
            <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <rect x="3" y="4" width="18" height="18" rx="2" strokeWidth="2"/>
                <path d="M16 2v4M8 2v4M3 10h18" strokeWidth="2"/>
            </svg>
        );

        const HeartIcon = () => (
            <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z" strokeWidth="2"/>
            </svg>
        );

        const TrendingUpIcon = () => (
            <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path d="M23 6l-9.5 9.5-5-5L1 18" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/>
                <path d="M17 6h6v6" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/>
            </svg>
        );

        const ZapIcon = () => (
            <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path d="M13 2L3 14h8l-1 8 10-12h-8l1-8z" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/>
            </svg>
        );

        const InfoIcon = () => (
            <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <circle cx="12" cy="12" r="10" strokeWidth="2"/>
                <path d="M12 16v-4M12 8h.01" strokeWidth="2" strokeLinecap="round"/>
            </svg>
        );

        const SproutIcon = () => (
            <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path d="M7 20h10M10 20c0-4.4 3.6-8 8-8h2M10 20c0-4.4-3.6-8-8-8H0" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/>
                <path d="M12 20V10c0-4.4 3.6-8 8-8" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/>
            </svg>
        );

        // Error Boundary to catch render crashes and prevent white screen
        class ErrorBoundary extends React.Component {
          constructor(props) {
            super(props);
            this.state = { hasError: false, error: null };
          }

          static getDerivedStateFromError(error) {
            return { hasError: true, error };
          }

          componentDidCatch(error, errorInfo) {
            console.error('[Perspective Engine] Render error caught:', error, errorInfo);
          }

          render() {
            if (this.state.hasError) {
              return React.createElement('div', {
                className: 'min-h-screen bg-gray-900 text-gray-100 p-8 flex items-center justify-center'
              },
                React.createElement('div', { className: 'max-w-2xl text-center' },
                  React.createElement('h1', { className: 'text-4xl font-bold mb-4' }, '⚠️ Rendering Error'),
                  React.createElement('p', { className: 'text-gray-400 mb-6' },
                    'The visualization encountered an error. This sometimes happens on mobile devices when loading complex animations.'
                  ),
                  React.createElement('p', { className: 'text-sm text-gray-500 mb-6' },
                    'Error: ' + (this.state.error?.message || 'Unknown error')
                  ),
                  React.createElement('button', {
                    onClick: () => window.location.reload(),
                    className: 'px-6 py-3 bg-green-600 hover:bg-green-700 text-white rounded-lg'
                  }, 'Reload Page')
                )
              );
            }

            return this.props.children;
          }
        }

        const PerspectiveEngine = () => {
          const [currentAge, setCurrentAge] = useState(30);
          const [goalAge, setGoalAge] = useState(85);
          const [quoteIndex, setQuoteIndex] = useState(0);

          // Module loading state
          const [modulesLoaded, setModulesLoaded] = useState(window.afterlifeModulesReady || false);

          // Afterlife feature state
          const [showAfterlife, setShowAfterlife] = useState(false);
          const [isDeathSequence, setIsDeathSequence] = useState(false);
          const [showWorldviewSelector, setShowWorldviewSelector] = useState(false);
          const [selectedWorldview, setSelectedWorldview] = useState(null);
          const [pageAtmosphere, setPageAtmosphere] = useState('');

          // Haptic feedback state (synced with HapticFeedback utility)
          const [hapticEnabled, setHapticEnabled] = useState(window.HapticFeedback.enabled);

          // Ref for scrolling to life grid
          const lifeGridRef = React.useRef(null);

          // Wait for modules to load
          useEffect(() => {
            const handleModulesLoaded = () => {
              setModulesLoaded(true);
              console.log('[Perspective Engine] Modules loaded, UI ready');
            };

            if (window.afterlifeModulesReady) {
              setModulesLoaded(true);
            } else {
              window.addEventListener('afterlifeModulesLoaded', handleModulesLoaded);
            }

            return () => {
              window.removeEventListener('afterlifeModulesLoaded', handleModulesLoaded);
            };
          }, []);

          // Initialize analytics on component mount
          useEffect(() => {
            if (window.Analytics) {
              window.Analytics.init();
            }
          }, []);

          const quotes = [
            { text: "You could leave life right now. Let that determine what you do and say and think.", author: "Marcus Aurelius" },
            { text: "The trouble is, you think you have time.", author: "Buddha" },
            { text: "Time is the coin of your life. It is the only coin you have, and only you can determine how it will be spent.", author: "Carl Sandburg" },
            { text: "The days are long but the decades are short.", author: "Sam Altman" },
            { text: "We are always getting ready to live but never living.", author: "Ralph Waldo Emerson" },
            { text: "Do not act as if you had ten thousand years to live.", author: "Marcus Aurelius" }
          ];

          // Use dynamically loaded worldviews from modules
          // This object is built from module metadata by the module loader
          // Re-compute whenever modules load to ensure we have the latest data
          const worldviews = React.useMemo(() => {
            const wv = window.AfterlifeWorldviews || {};
            console.log('[Perspective Engine] Worldviews recomputed. Count:', Object.keys(wv).length);
            return wv;
          }, [modulesLoaded]);

          useEffect(() => {
            const interval = setInterval(() => {
              setQuoteIndex((prev) => (prev + 1) % quotes.length);
            }, 8000);
            return () => clearInterval(interval);
          }, []);

          // Debug: Log modal state changes
          useEffect(() => {
            console.log('[Perspective Engine] State change detected:');
            console.log('  - showWorldviewSelector:', showWorldviewSelector);
            console.log('  - showAfterlife:', showAfterlife);
            console.log('  - selectedWorldview:', selectedWorldview);
            if (selectedWorldview) {
              console.log('  - worldview data exists:', !!worldviews[selectedWorldview]);
              console.log('  - module exists:', !!window.AfterlifeModules?.[selectedWorldview]);
            }
          }, [showWorldviewSelector, showAfterlife, selectedWorldview]);

          // Afterlife feature handlers
          const handleWhatComesAfter = () => {
            console.log('[Perspective Engine] "What Comes After" button clicked');
            console.log('[Perspective Engine] Modules loaded:', Object.keys(window.AfterlifeModules || {}).length);
            console.log('[Perspective Engine] Worldviews available:', Object.keys(window.AfterlifeWorldviews || {}).length);

            // Guard: check if modules are loaded
            if (!modulesLoaded || Object.keys(worldviews).length === 0) {
              console.error('[Perspective Engine] Cannot show afterlife - modules not loaded yet');
              alert('Loading afterlife perspectives... Please try again in a moment.');
              return;
            }

            setShowAfterlife(true);
            setIsDeathSequence(true);

            // Trigger haptic feedback for death sequence
            if (window.HapticFeedback) {
              window.HapticFeedback.onDeathSequence();
            }

            // Death sequence: dim all future dots then show selector (reduced for snappier UX)
            setTimeout(() => {
              setIsDeathSequence(false);
              setShowWorldviewSelector(true);
              console.log('[Perspective Engine] Worldview selector should now be visible');
            }, 500);
          };

          const handleWorldviewSelect = (worldviewKey) => {
            console.log('[Perspective Engine] ========== WORLDVIEW SELECTION START ==========');
            console.log('[Perspective Engine] Worldview selected:', worldviewKey);
            console.log('[Perspective Engine] Worldview data:', worldviews[worldviewKey]);
            console.log('[Perspective Engine] All available worldviews:', Object.keys(worldviews));
            console.log('[Perspective Engine] Modules in window.AfterlifeModules:', Object.keys(window.AfterlifeModules || {}));
            console.log('[Perspective Engine] modulesLoaded state:', modulesLoaded);

            // Check if worldview exists
            if (!worldviews[worldviewKey]) {
              console.error('[Perspective Engine] ERROR: Worldview not found:', worldviewKey);
              console.error('[Perspective Engine] This likely means modules haven\'t loaded yet');
              alert('Worldview modules are still loading. Please try again in a moment.');
              return;
            }

            console.log('[Perspective Engine] Setting selectedWorldview state...');
            setSelectedWorldview(worldviewKey);

            console.log('[Perspective Engine] Closing worldview selector modal...');
            setShowWorldviewSelector(false);

            // Safely set atmosphere with fallback
            const selectedWorldview = worldviews[worldviewKey];
            if (selectedWorldview && selectedWorldview.atmosphere) {
              console.log('[Perspective Engine] Setting atmosphere:', selectedWorldview.atmosphere);
              setPageAtmosphere(selectedWorldview.atmosphere);
            } else {
              console.warn('[Perspective Engine] No atmosphere found for', worldviewKey);
              setPageAtmosphere('');
            }

            console.log('[Perspective Engine] ========== WORLDVIEW SELECTION COMPLETE ==========');

            // Trigger haptic feedback for Christian Heaven ascension
            if (worldviewKey === 'christianity-heaven' && window.HapticFeedback) {
              // Slight delay to sync with animation start
              setTimeout(() => {
                window.HapticFeedback.onAscent();
              }, 100);
            }

            // Scroll to life grid with smooth animation
            setTimeout(() => {
              if (lifeGridRef.current) {
                lifeGridRef.current.scrollIntoView({
                  behavior: 'smooth',
                  block: 'center'
                });
              }
            }, 100);
          };

          const handleReset = () => {
            setShowAfterlife(false);
            setIsDeathSequence(false);
            setShowWorldviewSelector(false);
            setSelectedWorldview(null);
            setPageAtmosphere('');
          };

          const handleCurrentAgeChange = (value) => {
            const age = Number(value);
            setCurrentAge(age);
            if (age >= goalAge) {
              setGoalAge(age + 1);
            }
          };

          const handleGoalAgeChange = (value) => {
            const age = Number(value);
            if (age > currentAge) {
              setGoalAge(age);
            }
          };

          const handleHapticToggle = () => {
            const newValue = !hapticEnabled;
            setHapticEnabled(newValue);
            if (newValue) {
              window.HapticFeedback.enable();
            } else {
              window.HapticFeedback.disable();
            }
          };

          // Calculate perceived time ratio for each year
          const getPerceivedTimeRatio = (age) => {
            // Using logarithmic perception: each year feels like 1/age of total life
            return 1 / age;
          };

          // Calculate total perceived time for normalization
          const getTotalPerceivedTime = () => {
            let total = 0;
            for (let age = 1; age <= goalAge; age++) {
              total += getPerceivedTimeRatio(age);
            }
            return total;
          };

          // Calculate dot size based on perceived time contribution
          // All dots together = 100%, each sized by its perceived time weight
          const getDotSize = (monthIndex) => {
            const yearAge = Math.floor(monthIndex / 12) + 1;
            if (yearAge === 0) return 2;

            // Each month in this year has 1/12th of that year's perceived time
            const monthPerceivedValue = getPerceivedTimeRatio(yearAge) / 12;
            const totalPerceivedTime = getTotalPerceivedTime();

            // Normalize to percentage of total perceived life
            const percentageOfLife = monthPerceivedValue / totalPerceivedTime;

            // Scale to reasonable pixel sizes (1-8px range)
            // Multiply by a factor to make dots visible
            const size = Math.max(1, Math.min(8, percentageOfLife * 3000));
            return size;
          };

          const calculateMetrics = () => {
            const totalMonths = goalAge * 12;
            const livedMonths = currentAge * 12;
            const remainingMonths = totalMonths - livedMonths;

            const daysRemaining = Math.floor(remainingMonths * 30.44);
            const weekendsRemaining = Math.floor(daysRemaining / 7); // One weekend per week
            const healthyYearsThreshold = 75;
            const healthyYearsRemaining = Math.max(0, healthyYearsThreshold - currentAge);
            const percentageLived = ((livedMonths / totalMonths) * 100).toFixed(1);

            // Calculate perceived time remaining
            let totalPerceivedTime = 0;
            let remainingPerceivedTime = 0;
            for (let age = 1; age <= goalAge; age++) {
              const perceived = getPerceivedTimeRatio(age);
              totalPerceivedTime += perceived;
              if (age > currentAge) {
                remainingPerceivedTime += perceived;
              }
            }
            const perceivedPercentageRemaining = ((remainingPerceivedTime / totalPerceivedTime) * 100).toFixed(1);

            return {
              totalMonths,
              livedMonths,
              remainingMonths,
              daysRemaining,
              weekendsRemaining,
              healthyYearsRemaining,
              percentageLived,
              perceivedPercentageRemaining
            };
          };

          const metrics = calculateMetrics();
          const currentQuote = quotes[quoteIndex];

          const getHealthColor = (monthIndex) => {
            const age = monthIndex / 12;

            if (age < 20) return 'bg-blue-300';
            if (age >= 20 && age < 40) return 'bg-green-300';
            if (age >= 40 && age < 60) return 'bg-yellow-300';
            if (age >= 60 && age < 75) return 'bg-orange-300';
            return 'bg-red-300';
          };

          // Helper function to get border class for worldview
          // Uses module-provided border class from metadata
          const getBorderClass = (worldviewKey) => {
            if (window.AfterlifeWorldviews && window.AfterlifeWorldviews[worldviewKey]) {
              return window.AfterlifeWorldviews[worldviewKey].borderClass || '';
            }
            return '';
          };

          const renderLifeGrid = () => {
            const squares = [];
            const currentMonth = Math.floor(currentAge * 12);

            for (let i = 0; i < metrics.totalMonths; i++) {
              const isPast = i < currentMonth;
              const isCurrent = i === currentMonth;
              const isFuture = i > currentMonth;
              const dotSize = getDotSize(i);
              const healthColor = getHealthColor(i);

              // Determine animation class based on worldview and afterlife state
              let animationClass = '';
              let animationStyle = {};
              let borderClass = '';

              // Apply worldview border to ALL dots when a worldview is selected
              if (selectedWorldview) {
                borderClass = getBorderClass(selectedWorldview);
              }

              // Handle death sequence animation
              if (isDeathSequence) {
                animationClass = 'animate-[die_0.5s_ease-out_forwards]';
                if (isFuture) {
                  animationStyle.animationDelay = `${(metrics.totalMonths - i) * 0.01}s`;
                }
              }
              // Use module-based animation system for afterlife perspectives
              else if (selectedWorldview && window.getAnimationForDot) {
                try {
                  const dot = {
                    index: i,
                    isPast,
                    isCurrent,
                    isFuture,
                    size: dotSize,
                    healthColor
                  };
                  const userData = {
                    currentAge,
                    lifeExpectancy: goalAge,
                    currentMonth: currentMonth,
                    totalMonths: metrics.totalMonths,
                    deathMonth: currentMonth
                  };

                  const animation = window.getAnimationForDot(dot, userData, selectedWorldview, false);
                  if (animation) {
                    animationClass = animation.class || '';
                    animationStyle = { ...animationStyle, ...(animation.style || {}) };
                  }
                } catch (error) {
                  console.error('[Perspective Engine] Error applying animation to dot:', error);
                  // Fail silently - dot will just not animate
                }
              }

              // NOW dot specific styling
              const nowDotClass = isCurrent && !showAfterlife ? 'pulse-now' : '';
              const nowDotScale = isCurrent && !showAfterlife ? 1.5 : 1;

              // Final pulse for NOW dot during death sequence
              if (isCurrent && isDeathSequence) {
                animationClass = 'animate-[final-pulse_1s_ease-in-out_3,die_0.5s_3s_ease-out_forwards]';
              }

              // Future dots get a glow effect to represent remaining perceived time
              const glowClass = !isPast && !isCurrent && !showAfterlife ? 'shadow-md' : '';

              squares.push(
                <div
                  key={i}
                  className={`transition-all duration-500 rounded-sm ${glowClass} ${nowDotClass} ${animationClass} ${borderClass} ${
                    isCurrent && !showAfterlife
                      ? 'bg-green-400 shadow-lg shadow-green-400/50'
                      : isPast || (showAfterlife && isFuture && !selectedWorldview)
                      ? 'bg-gray-600/60'
                      : `${healthColor} shadow-${healthColor.replace('bg-', '')}/50`
                  }`}
                  style={{
                    width: `${dotSize * 2 * nowDotScale}px`,
                    height: `${dotSize * 2 * nowDotScale}px`,
                    ...animationStyle
                  }}
                  title={`Month ${i + 1} - Age ${Math.floor(i / 12)} - Perceived contribution: ${(dotSize / 8 * 100).toFixed(2)}%`}
                />
              );
            }
            return squares;
          };

          return (
            <div className={`min-h-screen transition-all duration-1000 text-gray-100 p-8 ${pageAtmosphere || 'bg-gradient-to-br from-gray-900 via-slate-900 to-gray-900'}`}>
              <div className="max-w-7xl mx-auto space-y-12">
                {/* Header */}
                <header className="text-center space-y-4">
                  <h1 className="text-5xl font-extralight tracking-wider text-gray-100">
                    The Perspective Engine
                  </h1>
                  <p className="text-gray-400 text-lg font-light max-w-2xl mx-auto">
                    A visual meditation on time, presence, and making it count
                  </p>
                  <nav className="pt-4">
                    <a href="/" className="text-green-400 hover:text-green-300 transition-colors" data-track="Back to Projects">
                      ← Back to Projects
                    </a>
                  </nav>
                </header>

                {/* Gentle Warning/Framing */}
                <div className="bg-amber-900/10 backdrop-blur-sm rounded-xl p-6 border border-amber-700/20 max-w-3xl mx-auto">
                  <div className="flex items-start gap-3">
                    <div className="text-amber-400/70 mt-1">⚡</div>
                    <div className="space-y-2 text-gray-300 font-light leading-relaxed text-sm">
                      <p className="font-medium text-amber-300/90">A note before you scroll:</p>
                      <p>
                        This tool visualizes theories about time perception that can feel confronting.
                        It's meant to inspire presence, not despair. Take what resonates, leave what doesn't—and
                        maybe don't operate heavy machinery while contemplating mortality.
                      </p>
                    </div>
                  </div>
                </div>

                {/* Input Section with Sliders */}
                <div className="bg-gray-800/30 backdrop-blur-sm rounded-2xl p-8 border border-gray-700/50 shadow-2xl">
                  <div className="grid md:grid-cols-2 gap-12 max-w-3xl mx-auto">
                    <div className="space-y-4">
                      <div className="flex justify-between items-center">
                        <label className="block text-sm font-light text-gray-300 tracking-wide">
                          Current Age
                        </label>
                        <span className="text-3xl font-extralight text-green-400">{currentAge}</span>
                      </div>
                      <input
                        type="range"
                        value={currentAge}
                        onChange={(e) => handleCurrentAgeChange(e.target.value)}
                        className="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-green-400"
                        min="1"
                        max="119"
                        step="1"
                        data-track="Adjust Current Age"
                      />
                      <div className="flex justify-between text-xs text-gray-500">
                        <span>1</span>
                        <span>119</span>
                      </div>
                    </div>
                    <div className="space-y-4">
                      <div className="flex justify-between items-center">
                        <label className="block text-sm font-light text-gray-300 tracking-wide">
                          Goal Age
                        </label>
                        <span className="text-3xl font-extralight text-blue-400">{goalAge}</span>
                      </div>
                      <input
                        type="range"
                        value={goalAge}
                        onChange={(e) => handleGoalAgeChange(e.target.value)}
                        className="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-blue-400"
                        min={currentAge + 1}
                        max="120"
                        step="1"
                        data-track="Adjust Goal Age"
                      />
                      <div className="flex justify-between text-xs text-gray-500">
                        <span>{currentAge + 1}</span>
                        <span>120</span>
                      </div>
                    </div>
                  </div>

                  {/* Haptic Feedback Toggle */}
                  <div className="flex justify-center mt-8 pt-6 border-t border-gray-700/30">
                    <label className="flex items-center gap-3 cursor-pointer group">
                      <span className="text-sm font-light text-gray-400 group-hover:text-gray-300 transition-colors tracking-wide">
                        Haptic Feedback
                      </span>
                      <div className="relative">
                        <input
                          type="checkbox"
                          checked={hapticEnabled}
                          onChange={handleHapticToggle}
                          className="sr-only peer"
                          data-track="Toggle Haptic Feedback"
                        />
                        <div className="w-11 h-6 bg-gray-700 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-purple-500/50 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-purple-600"></div>
                      </div>
                      {window.HapticFeedback && !window.HapticFeedback.isSupported() && (
                        <span className="text-xs text-gray-600 italic">(Not supported on this device)</span>
                      )}
                    </label>
                  </div>
                </div>

                {/* Metrics Dashboard */}
                <div className="grid md:grid-cols-5 gap-6">
                  <div className="bg-gray-800/30 backdrop-blur-sm rounded-2xl p-6 border border-gray-700/50 space-y-3">
                    <div className="flex items-center gap-3 text-gray-400">
                      <ClockIcon />
                      <span className="text-sm font-light tracking-wide">Days Left</span>
                    </div>
                    <p className="text-4xl font-extralight text-gray-100">
                      {metrics.daysRemaining.toLocaleString()}
                    </p>
                  </div>

                  <div className="bg-gray-800/30 backdrop-blur-sm rounded-2xl p-6 border border-gray-700/50 space-y-3">
                    <div className="flex items-center gap-3 text-gray-400">
                      <CalendarIcon />
                      <span className="text-sm font-light tracking-wide">Weekends</span>
                    </div>
                    <p className="text-4xl font-extralight text-gray-100">
                      {metrics.weekendsRemaining.toLocaleString()}
                    </p>
                  </div>

                  <div className="bg-gray-800/30 backdrop-blur-sm rounded-2xl p-6 border border-gray-700/50 space-y-3">
                    <div className="flex items-center gap-3 text-gray-400">
                      <HeartIcon />
                      <span className="text-sm font-light tracking-wide">Healthy Years</span>
                    </div>
                    <p className="text-4xl font-extralight text-gray-100">
                      {metrics.healthyYearsRemaining}
                    </p>
                  </div>

                  <div className="bg-gray-800/30 backdrop-blur-sm rounded-2xl p-6 border border-gray-700/50 space-y-3">
                    <div className="flex items-center gap-3 text-gray-400">
                      <TrendingUpIcon />
                      <span className="text-sm font-light tracking-wide">Life Lived</span>
                    </div>
                    <p className="text-4xl font-extralight text-gray-100">
                      {metrics.percentageLived}%
                    </p>
                  </div>

                  <div className="bg-gradient-to-br from-purple-900/20 to-purple-800/10 backdrop-blur-sm rounded-2xl p-6 border border-purple-700/30 space-y-3">
                    <div className="flex items-center gap-2 text-purple-300">
                      <ZapIcon />
                      <span className="text-sm font-light tracking-wide">Perceived Time (One Theory)</span>
                      <div
                        className="cursor-help text-purple-400/60 hover:text-purple-300 transition-colors"
                        title="Based on the proportional theory—one model of time perception. Your actual experience may vary based on novelty, presence, and how you live."
                      >
                        <InfoIcon />
                      </div>
                    </div>
                    <p className="text-4xl font-extralight text-purple-200">
                      {metrics.perceivedPercentageRemaining}%
                    </p>
                  </div>
                </div>

                {/* Perception Explanation */}
                <div className="bg-gradient-to-br from-purple-900/20 to-purple-800/10 backdrop-blur-sm rounded-2xl p-8 border border-purple-700/30">
                  <div className="flex items-start gap-4">
                    <ZapIcon />
                    <div className="space-y-3">
                      <h3 className="text-xl font-light text-purple-200">Perceptual Time Theory</h3>
                      <p className="text-gray-300 font-light leading-relaxed">
                        Notice how the dots grow smaller as you age? This visualizes the <strong>Proportional Theory</strong>:
                        at age 5, one year is 20% of your entire life. At 50, it's just 2%. Your brain encodes less novelty
                        as routines form, and neural processing slows—making time feel like it's accelerating. The perceived
                        time metric above offers <em>one model</em> of how much felt experience might remain—though your
                        mileage may vary. Novelty, presence, and intentional living can stretch time back out.
                      </p>
                    </div>
                  </div>
                </div>

                {/* Progress Bars */}
                <div className="grid md:grid-cols-2 gap-6">
                  <div className="bg-gray-800/30 backdrop-blur-sm rounded-2xl p-8 border border-gray-700/50">
                    <div className="space-y-4">
                      <h3 className="text-lg font-light text-gray-300">Calendar Time</h3>
                      <div className="flex justify-between text-sm text-gray-400 font-light">
                        <span>Birth</span>
                        <span className="text-green-400">Now</span>
                        <span>Age {goalAge}</span>
                      </div>
                      <div className="h-3 bg-gray-700/60 rounded-full overflow-hidden">
                        <div
                          className="h-full bg-gradient-to-r from-gray-600 to-green-400 transition-all duration-1000"
                          style={{ width: `${metrics.percentageLived}%` }}
                        />
                      </div>
                    </div>
                  </div>

                  <div className="bg-purple-900/20 backdrop-blur-sm rounded-2xl p-8 border border-purple-700/30">
                    <div className="space-y-4">
                      <h3 className="text-lg font-light text-purple-200">Perceived Time</h3>
                      <div className="flex justify-between text-sm text-purple-300 font-light">
                        <span>Birth</span>
                        <span className="text-purple-400">Now</span>
                        <span>Age {goalAge}</span>
                      </div>
                      <div className="h-3 bg-purple-800/60 rounded-full overflow-hidden">
                        <div
                          className="h-full bg-gradient-to-r from-purple-600 to-purple-400 transition-all duration-1000"
                          style={{ width: `${100 - parseFloat(metrics.perceivedPercentageRemaining)}%` }}
                        />
                      </div>
                    </div>
                  </div>
                </div>

                {/* Life Grid */}
                <div ref={lifeGridRef} className="bg-gray-800/30 backdrop-blur-sm rounded-2xl p-8 border border-gray-700/50">
                  <h2 className="text-2xl font-extralight text-gray-100 mb-6 text-center">
                    Your Life in Months (Scaled by Perceived Time)
                  </h2>

                  {/* Afterlife Sequence Label */}
                  {selectedWorldview && worldviews[selectedWorldview] && (
                    <div className="mb-6 max-w-2xl mx-auto">
                      <div className="bg-gradient-to-br from-gray-700/40 to-gray-800/40 backdrop-blur-sm rounded-xl p-5 border border-gray-600/50">
                        <div className="flex items-start gap-3">
                          <div className="text-2xl">✨</div>
                          <div className="flex-1">
                            <h3 className="text-lg font-medium text-gray-100 mb-2">
                              {worldviews[selectedWorldview]?.name || 'Unknown Worldview'}
                            </h3>
                            <p className="text-sm text-gray-300 font-light leading-relaxed mb-3">
                              What's happening to the dots: {worldviews[selectedWorldview]?.description || 'Loading...'}
                            </p>
                            <a
                              href={worldviews[selectedWorldview]?.source || '#'}
                              target="_blank"
                              rel="noopener noreferrer"
                              className="inline-flex items-center gap-1.5 text-xs text-green-400 hover:text-green-300 transition-colors"
                            >
                              <InfoIcon />
                              <span>Learn more about this worldview</span>
                            </a>
                          </div>
                        </div>
                      </div>
                    </div>
                  )}

                  <div className="flex flex-wrap gap-1 justify-center max-w-5xl mx-auto items-end">
                    {renderLifeGrid()}
                  </div>
                  <div className="flex justify-center gap-6 mt-8 text-sm text-gray-400 font-light flex-wrap">
                    <div className="flex items-center gap-2">
                      <div className="w-3 h-3 bg-gray-500/70" />
                      <span>Past</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <div className="w-3 h-3 bg-green-400 shadow-lg shadow-green-400/50" />
                      <span>Current</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <div className="w-3 h-3 bg-blue-300" />
                      <span>Youth (0-20)</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <div className="w-3 h-3 bg-green-300" />
                      <span>Peak (20-40)</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <div className="w-3 h-3 bg-yellow-300" />
                      <span>Prime (40-60)</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <div className="w-3 h-3 bg-orange-300" />
                      <span>Mature (60-75)</span>
                    </div>
                    <div className="flex items-center gap-2">
                      <div className="w-3 h-3 bg-red-300" />
                      <span>Elder (75+)</span>
                    </div>
                  </div>

                  {/* What Comes After Button */}
                  {!showAfterlife && (
                    <div className="flex justify-center mt-8">
                      <button
                        onClick={handleWhatComesAfter}
                        disabled={!modulesLoaded}
                        className={`px-6 py-3 rounded-lg border transition-all duration-300 font-light tracking-wide text-sm ${
                          modulesLoaded
                            ? 'bg-gray-700/50 hover:bg-gray-600/50 text-gray-300 hover:text-gray-100 border-gray-600/50 hover:border-gray-500/70'
                            : 'bg-gray-800/30 text-gray-500 border-gray-700/30 cursor-not-allowed'
                        }`}
                        data-track="What Comes After Button"
                      >
                        {modulesLoaded ? 'What Comes After' : 'Loading perspectives...'}
                      </button>
                    </div>
                  )}

                  {/* Reset Button */}
                  {selectedWorldview && (
                    <div className="flex justify-center mt-8">
                      <button
                        onClick={handleReset}
                        className="px-6 py-3 bg-green-700/50 hover:bg-green-600/50 text-green-300 hover:text-green-100 rounded-lg border border-green-600/50 hover:border-green-500/70 transition-all duration-300 font-light tracking-wide text-sm"
                        data-track="Reset to Life Button"
                      >
                        Return to Life
                      </button>
                    </div>
                  )}
                </div>

                {/* Worldview Selector Modal */}
                {showWorldviewSelector && (
                  <div className="modal-backdrop" onClick={() => setShowWorldviewSelector(false)}>
                    <div className="modal-content bg-gray-800/95 backdrop-blur-md rounded-2xl p-8 border border-gray-700/70 max-w-4xl mx-4" onClick={(e) => e.stopPropagation()}>
                      <h2 className="text-3xl font-extralight text-gray-100 mb-6 text-center">What Comes After</h2>
                      <p className="text-gray-400 text-center mb-8 font-light">
                        Different worldviews offer different answers. Choose one to explore:
                      </p>

                      <div className="space-y-6">
                        {/* Traditional Religions */}
                        <div>
                          <h3 className="text-lg font-light text-gray-300 mb-3 flex items-center gap-2">
                            Traditional Religions
                          </h3>
                          <div className="grid md:grid-cols-2 gap-3">
                            <button
                              onClick={() => handleWorldviewSelect('buddhism-rebirth')}
                              className="p-4 bg-gray-700/50 hover:bg-blue-900/30 rounded-lg border border-gray-600/50 hover:border-blue-500/50 transition-all text-left"
                              data-track="Select Buddhism Rebirth"
                            >
                              <div className="flex items-start justify-between">
                                <div>
                                  <div className="font-medium text-gray-200">Buddhism - Rebirth</div>
                                  <div className="text-sm text-gray-400 mt-1">{worldviews['buddhism-rebirth']?.description}</div>
                                </div>
                                <a href={worldviews['buddhism-rebirth']?.source} target="_blank" rel="noopener noreferrer" onClick={(e) => e.stopPropagation()} className="text-gray-500 hover:text-gray-300 ml-2">
                                  <InfoIcon />
                                </a>
                              </div>
                            </button>

                            <button
                              onClick={() => handleWorldviewSelect('buddhism-nirvana')}
                              className="p-4 bg-gray-700/50 hover:bg-blue-900/30 rounded-lg border border-gray-600/50 hover:border-blue-500/50 transition-all text-left"
                              data-track="Select Buddhism Nirvana"
                            >
                              <div className="flex items-start justify-between">
                                <div>
                                  <div className="font-medium text-gray-200">Buddhism - Nirvana</div>
                                  <div className="text-sm text-gray-400 mt-1">{worldviews['buddhism-nirvana']?.description}</div>
                                </div>
                                <a href={worldviews['buddhism-nirvana']?.source} target="_blank" rel="noopener noreferrer" onClick={(e) => e.stopPropagation()} className="text-gray-500 hover:text-gray-300 ml-2">
                                  <InfoIcon />
                                </a>
                              </div>
                            </button>

                            <button
                              onClick={() => handleWorldviewSelect('christianity-heaven')}
                              className="p-4 bg-gray-700/50 hover:bg-yellow-900/30 rounded-lg border border-gray-600/50 hover:border-yellow-500/50 transition-all text-left"
                              data-track="Select Christianity Heaven"
                            >
                              <div className="flex items-start justify-between">
                                <div>
                                  <div className="font-medium text-gray-200">Christianity - Heaven</div>
                                  <div className="text-sm text-gray-400 mt-1">{worldviews['christianity-heaven']?.description}</div>
                                </div>
                                <a href={worldviews['christianity-heaven']?.source} target="_blank" rel="noopener noreferrer" onClick={(e) => e.stopPropagation()} className="text-gray-500 hover:text-gray-300 ml-2">
                                  <InfoIcon />
                                </a>
                              </div>
                            </button>

                            <button
                              onClick={() => handleWorldviewSelect('christianity-purgatory')}
                              className="p-4 bg-gray-700/50 hover:bg-yellow-900/30 rounded-lg border border-gray-600/50 hover:border-yellow-500/50 transition-all text-left"
                              data-track="Select Christianity Purgatory"
                            >
                              <div className="flex items-start justify-between">
                                <div>
                                  <div className="font-medium text-gray-200">Christianity - Purgatory</div>
                                  <div className="text-sm text-gray-400 mt-1">{worldviews['christianity-purgatory']?.description}</div>
                                </div>
                                <a href={worldviews['christianity-purgatory']?.source} target="_blank" rel="noopener noreferrer" onClick={(e) => e.stopPropagation()} className="text-gray-500 hover:text-gray-300 ml-2">
                                  <InfoIcon />
                                </a>
                              </div>
                            </button>

                            <button
                              onClick={() => handleWorldviewSelect('christianity-hell')}
                              className="p-4 bg-gray-700/50 hover:bg-red-900/30 rounded-lg border border-gray-600/50 hover:border-red-500/50 transition-all text-left"
                              data-track="Select Christianity Hell"
                            >
                              <div className="flex items-start justify-between">
                                <div>
                                  <div className="font-medium text-gray-200">Christianity - Hell</div>
                                  <div className="text-sm text-gray-400 mt-1">{worldviews['christianity-hell']?.description}</div>
                                </div>
                                <a href={worldviews['christianity-hell']?.source} target="_blank" rel="noopener noreferrer" onClick={(e) => e.stopPropagation()} className="text-gray-500 hover:text-gray-300 ml-2">
                                  <InfoIcon />
                                </a>
                              </div>
                            </button>

                            <button
                              onClick={() => handleWorldviewSelect('islam-jannah')}
                              className="p-4 bg-gray-700/50 hover:bg-green-900/30 rounded-lg border border-gray-600/50 hover:border-green-500/50 transition-all text-left"
                              data-track="Select Islam Jannah"
                            >
                              <div className="flex items-start justify-between">
                                <div>
                                  <div className="font-medium text-gray-200">Islam - Jannah</div>
                                  <div className="text-sm text-gray-400 mt-1">{worldviews['islam-jannah']?.description}</div>
                                </div>
                                <a href={worldviews['islam-jannah']?.source} target="_blank" rel="noopener noreferrer" onClick={(e) => e.stopPropagation()} className="text-gray-500 hover:text-gray-300 ml-2">
                                  <InfoIcon />
                                </a>
                              </div>
                            </button>

                            <button
                              onClick={() => handleWorldviewSelect('islam-jahannam')}
                              className="p-4 bg-gray-700/50 hover:bg-red-900/30 rounded-lg border border-gray-600/50 hover:border-red-500/50 transition-all text-left"
                              data-track="Select Islam Jahannam"
                            >
                              <div className="flex items-start justify-between">
                                <div>
                                  <div className="font-medium text-gray-200">Islam - Jahannam</div>
                                  <div className="text-sm text-gray-400 mt-1">{worldviews['islam-jahannam']?.description}</div>
                                </div>
                                <a href={worldviews['islam-jahannam']?.source} target="_blank" rel="noopener noreferrer" onClick={(e) => e.stopPropagation()} className="text-gray-500 hover:text-gray-300 ml-2">
                                  <InfoIcon />
                                </a>
                              </div>
                            </button>

                            <button
                              onClick={() => handleWorldviewSelect('hinduism-reincarnation')}
                              className="p-4 bg-gray-700/50 hover:bg-orange-900/30 rounded-lg border border-gray-600/50 hover:border-orange-500/50 transition-all text-left"
                              data-track="Select Hinduism Reincarnation"
                            >
                              <div className="flex items-start justify-between">
                                <div>
                                  <div className="font-medium text-gray-200">Hinduism - Reincarnation</div>
                                  <div className="text-sm text-gray-400 mt-1">{worldviews['hinduism-reincarnation']?.description}</div>
                                </div>
                                <a href={worldviews['hinduism-reincarnation']?.source} target="_blank" rel="noopener noreferrer" onClick={(e) => e.stopPropagation()} className="text-gray-500 hover:text-gray-300 ml-2">
                                  <InfoIcon />
                                </a>
                              </div>
                            </button>

                            <button
                              onClick={() => handleWorldviewSelect('hinduism-moksha')}
                              className="p-4 bg-gray-700/50 hover:bg-orange-900/30 rounded-lg border border-gray-600/50 hover:border-orange-500/50 transition-all text-left"
                              data-track="Select Hinduism Moksha"
                            >
                              <div className="flex items-start justify-between">
                                <div>
                                  <div className="font-medium text-gray-200">Hinduism - Moksha</div>
                                  <div className="text-sm text-gray-400 mt-1">{worldviews['hinduism-moksha']?.description}</div>
                                </div>
                                <a href={worldviews['hinduism-moksha']?.source} target="_blank" rel="noopener noreferrer" onClick={(e) => e.stopPropagation()} className="text-gray-500 hover:text-gray-300 ml-2">
                                  <InfoIcon />
                                </a>
                              </div>
                            </button>

                            <button
                              onClick={() => handleWorldviewSelect('judaism')}
                              className="p-4 bg-gray-700/50 hover:bg-yellow-900/30 rounded-lg border border-gray-600/50 hover:border-yellow-500/50 transition-all text-left"
                              data-track="Select Judaism"
                            >
                              <div className="flex items-start justify-between">
                                <div>
                                  <div className="font-medium text-gray-200">Judaism - Olam Ha-Ba</div>
                                  <div className="text-sm text-gray-400 mt-1">{worldviews.judaism?.description}</div>
                                </div>
                                <a href={worldviews.judaism?.source} target="_blank" rel="noopener noreferrer" onClick={(e) => e.stopPropagation()} className="text-gray-500 hover:text-gray-300 ml-2">
                                  <InfoIcon />
                                </a>
                              </div>
                            </button>

                            <button
                              onClick={() => handleWorldviewSelect('ancestor')}
                              className="p-4 bg-gray-700/50 hover:bg-stone-900/30 rounded-lg border border-gray-600/50 hover:border-stone-500/50 transition-all text-left"
                              data-track="Select Ancestor Traditions"
                            >
                              <div className="flex items-start justify-between">
                                <div>
                                  <div className="font-medium text-gray-200">Ancestor Traditions</div>
                                  <div className="text-sm text-gray-400 mt-1">{worldviews.ancestor?.description}</div>
                                </div>
                                <a href={worldviews.ancestor?.source} target="_blank" rel="noopener noreferrer" onClick={(e) => e.stopPropagation()} className="text-gray-500 hover:text-gray-300 ml-2">
                                  <InfoIcon />
                                </a>
                              </div>
                            </button>
                          </div>
                        </div>

                        {/* Philosophical Frameworks */}
                        <div>
                          <h3 className="text-lg font-light text-gray-300 mb-3">Philosophical Frameworks</h3>
                          <div className="grid md:grid-cols-2 gap-3">
                            <button
                              onClick={() => handleWorldviewSelect('idealism')}
                              className="p-4 bg-gray-700/50 hover:bg-purple-900/30 rounded-lg border border-gray-600/50 hover:border-purple-500/50 transition-all text-left"
                              data-track="Select Analytic Idealism"
                            >
                              <div className="flex items-start justify-between">
                                <div>
                                  <div className="font-medium text-gray-200">Analytic Idealism</div>
                                  <div className="text-sm text-gray-400 mt-1">{worldviews.idealism?.description}</div>
                                </div>
                                <a href={worldviews.idealism?.source} target="_blank" rel="noopener noreferrer" onClick={(e) => e.stopPropagation()} className="text-gray-500 hover:text-gray-300 ml-2">
                                  <InfoIcon />
                                </a>
                              </div>
                            </button>

                            <button
                              onClick={() => handleWorldviewSelect('panpsychism')}
                              className="p-4 bg-gray-700/50 hover:bg-blue-900/30 rounded-lg border border-gray-600/50 hover:border-blue-500/50 transition-all text-left"
                              data-track="Select Panpsychism"
                            >
                              <div className="flex items-start justify-between">
                                <div>
                                  <div className="font-medium text-gray-200">Panpsychism</div>
                                  <div className="text-sm text-gray-400 mt-1">{worldviews.panpsychism?.description}</div>
                                </div>
                                <a href={worldviews.panpsychism?.source} target="_blank" rel="noopener noreferrer" onClick={(e) => e.stopPropagation()} className="text-gray-500 hover:text-gray-300 ml-2">
                                  <InfoIcon />
                                </a>
                              </div>
                            </button>

                            <button
                              onClick={() => handleWorldviewSelect('illusionism')}
                              className="p-4 bg-gray-700/50 hover:bg-gray-600/30 rounded-lg border border-gray-600/50 hover:border-gray-500/50 transition-all text-left"
                              data-track="Select Illusionism"
                            >
                              <div className="flex items-start justify-between">
                                <div>
                                  <div className="font-medium text-gray-200">Illusionism</div>
                                  <div className="text-sm text-gray-400 mt-1">{worldviews.illusionism?.description}</div>
                                </div>
                                <a href={worldviews.illusionism?.source} target="_blank" rel="noopener noreferrer" onClick={(e) => e.stopPropagation()} className="text-gray-500 hover:text-gray-300 ml-2">
                                  <InfoIcon />
                                </a>
                              </div>
                            </button>

                            <button
                              onClick={() => handleWorldviewSelect('simulation')}
                              className="p-4 bg-gray-700/50 hover:bg-cyan-900/30 rounded-lg border border-gray-600/50 hover:border-cyan-500/50 transition-all text-left"
                              data-track="Select Simulation Theory"
                            >
                              <div className="flex items-start justify-between">
                                <div>
                                  <div className="font-medium text-gray-200">Simulation Theory</div>
                                  <div className="text-sm text-gray-400 mt-1">{worldviews.simulation?.description}</div>
                                </div>
                                <a href={worldviews.simulation?.source} target="_blank" rel="noopener noreferrer" onClick={(e) => e.stopPropagation()} className="text-gray-500 hover:text-gray-300 ml-2">
                                  <InfoIcon />
                                </a>
                              </div>
                            </button>
                          </div>
                        </div>

                        {/* Materialist / Scientific */}
                        <div>
                          <h3 className="text-lg font-light text-gray-300 mb-3">Materialist / Scientific</h3>
                          <div className="grid md:grid-cols-2 gap-3">
                            <button
                              onClick={() => handleWorldviewSelect('atomic')}
                              className="p-4 bg-gray-700/50 hover:bg-green-900/30 rounded-lg border border-gray-600/50 hover:border-green-500/50 transition-all text-left"
                              data-track="Select Atomic Dispersal"
                            >
                              <div className="flex items-start justify-between">
                                <div>
                                  <div className="font-medium text-gray-200">Atomic Dispersal</div>
                                  <div className="text-sm text-gray-400 mt-1">{worldviews.atomic?.description}</div>
                                </div>
                                <a href={worldviews.atomic?.source} target="_blank" rel="noopener noreferrer" onClick={(e) => e.stopPropagation()} className="text-gray-500 hover:text-gray-300 ml-2">
                                  <InfoIcon />
                                </a>
                              </div>
                            </button>

                            <button
                              onClick={() => handleWorldviewSelect('heatdeath')}
                              className="p-4 bg-gray-700/50 hover:bg-slate-900/30 rounded-lg border border-gray-600/50 hover:border-slate-500/50 transition-all text-left"
                              data-track="Select Heat Death"
                            >
                              <div className="flex items-start justify-between">
                                <div>
                                  <div className="font-medium text-gray-200">Heat Death</div>
                                  <div className="text-sm text-gray-400 mt-1">{worldviews.heatdeath?.description}</div>
                                </div>
                                <a href={worldviews.heatdeath?.source} target="_blank" rel="noopener noreferrer" onClick={(e) => e.stopPropagation()} className="text-gray-500 hover:text-gray-300 ml-2">
                                  <InfoIcon />
                                </a>
                              </div>
                            </button>

                            <button
                              onClick={() => handleWorldviewSelect('materialism')}
                              className="p-4 bg-gray-700/50 hover:bg-gray-900/50 rounded-lg border border-gray-600/50 hover:border-gray-500/50 transition-all text-left"
                              data-track="Select Materialism"
                            >
                              <div className="flex items-start justify-between">
                                <div>
                                  <div className="font-medium text-gray-200">Materialism</div>
                                  <div className="text-sm text-gray-400 mt-1">{worldviews.materialism?.description}</div>
                                </div>
                                <a href={worldviews.materialism?.source} target="_blank" rel="noopener noreferrer" onClick={(e) => e.stopPropagation()} className="text-gray-500 hover:text-gray-300 ml-2">
                                  <InfoIcon />
                                </a>
                              </div>
                            </button>
                          </div>
                        </div>
                      </div>

                      <div className="mt-8 text-center">
                        <button
                          onClick={() => setShowWorldviewSelector(false)}
                          className="px-6 py-2 bg-gray-700/50 hover:bg-gray-600/50 text-gray-300 hover:text-gray-100 rounded-lg border border-gray-600/50 hover:border-gray-500/70 transition-all"
                        >
                          Close
                        </button>
                      </div>
                    </div>
                  </div>
                )}

                {/* Reclaim Your Time - Hope Section */}
                <div className="bg-gradient-to-br from-green-900/15 to-emerald-900/10 backdrop-blur-sm rounded-2xl p-8 border border-green-700/30">
                  <div className="flex items-start gap-4 max-w-4xl mx-auto">
                    <div className="text-green-400 mt-1">
                      <SproutIcon />
                    </div>
                    <div className="space-y-4">
                      <h3 className="text-2xl font-light text-green-200">The Good News: Time Expands With Presence</h3>
                      <p className="text-gray-300 font-light leading-relaxed">
                        The science of time perception suggests you can push back against acceleration. While routines
                        and comfort tend to compress our experience of time, you have agency in how time feels:
                      </p>
                      <ul className="space-y-3 text-gray-300 font-light leading-relaxed">
                        <li className="flex gap-3">
                          <span className="text-green-400 mt-1">•</span>
                          <div>
                            <strong className="text-green-300">Seek novelty:</strong> New experiences create richer memories,
                            making time feel longer in retrospect. Travel, learn new skills, break your routines.
                          </div>
                        </li>
                        <li className="flex gap-3">
                          <span className="text-green-400 mt-1">•</span>
                          <div>
                            <strong className="text-green-300">Practice presence:</strong> Mindfulness and attention to the
                            current moment expand subjective time. The opposite of "where did the day go?"
                          </div>
                        </li>
                        <li className="flex gap-3">
                          <span className="text-green-400 mt-1">•</span>
                          <div>
                            <strong className="text-green-300">Create milestones:</strong> Memorable events anchor time.
                            A year with distinct chapters feels longer than one undifferentiated blur.
                          </div>
                        </li>
                        <li className="flex gap-3">
                          <span className="text-green-400 mt-1">•</span>
                          <div>
                            <strong className="text-green-300">Embrace discomfort:</strong> Growth and challenge stretch
                            time. Comfort and routine compress it.
                          </div>
                        </li>
                      </ul>
                      <p className="text-gray-400 font-light italic text-sm pt-2">
                        Your perception of time isn't fixed—it's shaped by how intentionally you live.
                      </p>
                    </div>
                  </div>
                </div>

                {/* Quote Section */}
                <div className="bg-gradient-to-br from-gray-800/40 to-gray-800/20 backdrop-blur-sm rounded-2xl p-12 border border-gray-700/50">
                  <blockquote className="space-y-6 text-center max-w-3xl mx-auto">
                    <p className="text-2xl font-light text-gray-200 leading-relaxed transition-all duration-500">
                      "{currentQuote.text}"
                    </p>
                    <footer className="text-gray-400 text-lg font-light">
                      — {currentQuote.author}
                    </footer>
                  </blockquote>
                </div>

                {/* Sources / Learn More */}
                <div className="bg-gray-800/20 backdrop-blur-sm rounded-xl p-6 border border-gray-700/30 max-w-3xl mx-auto">
                  <h4 className="text-sm font-medium text-gray-400 mb-3 tracking-wide">Further Reading</h4>
                  <div className="space-y-2 text-xs text-gray-500 font-light">
                    <p>
                      <a
                        href="https://www.amazon.com/Why-Time-Flies-Mostly-Scientific/dp/1416540288"
                        target="_blank"
                        rel="noopener noreferrer"
                        className="text-gray-400 hover:text-green-400 transition-colors underline decoration-dotted"
                      >
                        Why Time Flies
                      </a>
                      {' '}by Alan Burdick — A beautifully written exploration of time perception
                    </p>
                    <p>
                      <a
                        href="https://en.wikipedia.org/wiki/Time_perception#Changes_with_age"
                        target="_blank"
                        rel="noopener noreferrer"
                        className="text-gray-400 hover:text-green-400 transition-colors underline decoration-dotted"
                      >
                        The Proportional Theory
                      </a>
                      {' '}— Wikipedia on time perception and aging
                    </p>
                    <p>
                      <a
                        href="https://pubmed.ncbi.nlm.nih.gov/23643368/"
                        target="_blank"
                        rel="noopener noreferrer"
                        className="text-gray-400 hover:text-green-400 transition-colors underline decoration-dotted"
                      >
                        Mindfulness and Time Perception
                      </a>
                      {' '}— Research on how mindfulness expands subjective time
                    </p>
                  </div>
                </div>

                {/* Materialism Clickable Overlay - Only shown when materialism perspective is active */}
                {selectedWorldview === 'materialism' && showAfterlife && (
                  <>
                    <div
                      onClick={handleReset}
                      onKeyDown={(e) => {
                        if (e.key === 'Escape') handleReset();
                      }}
                      tabIndex={0}
                      style={{
                        position: 'fixed',
                        inset: 0,
                        zIndex: 45,
                        cursor: 'pointer'
                      }}
                      aria-label="Press any key or tap to return"
                    />
                    <div className="materialism-exit-hint">
                      Tap anywhere to return
                    </div>
                  </>
                )}
              </div>
            </div>
          );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(
          <ErrorBoundary>
            <PerspectiveEngine />
          </ErrorBoundary>
        );
    </script>
</body>
</html>
